# ğŸ¤ å®¢æˆ·è®¿è°ˆç³»ç»Ÿï¼ˆQuestion Agentï¼‰

åŸºäºé˜¶è·ƒæ˜Ÿè¾° Realtime API çš„æ™ºèƒ½è¯­éŸ³è®¿è°ˆç³»ç»Ÿï¼Œç”¨äºå‘å®¢æˆ·æé—®å¹¶è‡ªåŠ¨è®°å½•å›ç­”ã€‚

[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

âœ¨ **æ ¸å¿ƒåŠŸèƒ½:**
- ğŸ¯ **ç»“æ„åŒ–è®¿è°ˆ** - æŒ‰é¢„è®¾é—®é¢˜åˆ—è¡¨é€ä¸ªæé—®
- ğŸ¤ **å®æ—¶è¯­éŸ³äº¤äº’** - è‡ªç„¶çš„è¯­éŸ³é—®ç­”ä½“éªŒ
- ğŸ“ **è‡ªåŠ¨è®°å½•** - è¯­éŸ³è½¬å†™ + æ–‡æœ¬è®°å½•
- ğŸ’¾ **ä¼šè¯ä¿å­˜** - JSON + æ–‡æœ¬åŒæ ¼å¼ä¿å­˜
- ğŸ“Š **è¿›åº¦è·Ÿè¸ª** - å®æ—¶æ˜¾ç¤ºè®¿è°ˆè¿›åº¦
- âš™ï¸ **çµæ´»é…ç½®** - YAML é…ç½®æ–‡ä»¶ç®¡ç†é—®é¢˜

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd /Users/town/code4/questionAgent

# ä½¿ç”¨ uvï¼ˆæ¨èï¼‰
uv sync

# æˆ–ä½¿ç”¨ pip
pip install -e .
```

é¢å¤–ä¾èµ–ï¼ˆéŸ³é¢‘å¤„ç†éœ€è¦ï¼‰ï¼š
```bash
# macOS
brew install libsndfile portaudio

# Ubuntu/Debian
sudo apt-get install libsndfile1 portaudio19-dev
```

### 2. é…ç½® API Key

```bash
export STEPFUN_API_KEY='your-api-key-here'
```

### 3. é…ç½®é—®é¢˜åˆ—è¡¨

ç¼–è¾‘ `questions.yaml` æ–‡ä»¶ï¼Œè‡ªå®šä¹‰æ‚¨çš„é—®é¢˜ï¼š

```yaml
questions:
  - id: 1
    question: "æ‚¨å¥½ï¼è¯·é—®æ‚¨è´µå§“ï¼Ÿ"
    type: "open"
    
  - id: 2
    question: "æ‚¨å¯¹äº§å“çš„æ•´ä½“æ»¡æ„åº¦å¦‚ä½•ï¼Ÿ"
    type: "open"
```

### 4. å¼€å§‹è®¿è°ˆ

```bash
# ç›´æ¥è¿è¡Œ
uv run python interview_client.py

# æˆ–ä½¿ç”¨è„šæœ¬ï¼ˆå¯é€‰ï¼‰
./scripts/interview.sh
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
questionAgent/
â”œâ”€â”€ interview_client.py       # ä¸»ç¨‹åº - è®¿è°ˆå®¢æˆ·ç«¯
â”œâ”€â”€ question_manager.py       # é—®é¢˜ç®¡ç†æ¨¡å—
â”œâ”€â”€ questions.yaml            # é—®é¢˜é…ç½®æ–‡ä»¶
â”œâ”€â”€ README.md                 # æœ¬æ–‡æ¡£
â”œâ”€â”€ pyproject.toml            # é¡¹ç›®é…ç½®
â”‚
â”œâ”€â”€ sessions/                 # è®¿è°ˆè®°å½•ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â””â”€â”€ 20241118_143052/     # ä¼šè¯æ–‡ä»¶å¤¹ï¼ˆæŒ‰æ—¶é—´å‘½åï¼‰
â”‚       â”œâ”€â”€ session.json      # è¯¦ç»†è®°å½•ï¼ˆJSONæ ¼å¼ï¼‰
â”‚       â””â”€â”€ summary.txt       # æ–‡æœ¬æ‘˜è¦
â”‚
â””â”€â”€ scripts/                  # è„šæœ¬ç›®å½•
    â””â”€â”€ interview.sh          # å¯åŠ¨è„šæœ¬
```

## ğŸ“ ä½¿ç”¨è¯´æ˜

### è®¿è°ˆæµç¨‹

1. **å¯åŠ¨ç³»ç»Ÿ** - ç³»ç»Ÿè¿æ¥åˆ° API å¹¶åŠ è½½é—®é¢˜
2. **æ¬¢è¿è¯­** - AI æ’­æ”¾æ¬¢è¿è¯­
3. **é€ä¸ªæé—®** - æŒ‰é…ç½®é¡ºåºæé—®
4. **ç­‰å¾…å›ç­”** - ç”¨æˆ·å¯¹ç€éº¦å…‹é£å›ç­”
5. **è‡ªåŠ¨è®°å½•** - è¯­éŸ³è½¬å†™å¹¶ä¿å­˜
6. **ç»§ç»­ä¸‹ä¸€é¢˜** - è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€ä¸ªé—®é¢˜
7. **å®Œæˆè®¿è°ˆ** - æ’­æ”¾ç»“æŸè¯­å¹¶ä¿å­˜è®°å½•

### é—®é¢˜é…ç½®æ ¼å¼

`questions.yaml` é…ç½®è¯´æ˜ï¼š

```yaml
# é—®é¢˜åˆ—è¡¨
questions:
  - id: 1                     # é—®é¢˜ç¼–å·ï¼ˆå¿…éœ€ï¼‰
    question: "é—®é¢˜å†…å®¹"      # é—®é¢˜æ–‡æœ¬ï¼ˆå¿…éœ€ï¼‰
    type: "open"              # é—®é¢˜ç±»å‹ï¼ˆå¯é€‰ï¼‰
    
# ç±»å‹é€‰é¡¹ï¼š
# - open: å¼€æ”¾å¼é—®é¢˜
# - yesno: æ˜¯éé¢˜
# - choice: é€‰æ‹©é¢˜

# å…¨å±€é…ç½®
settings:
  welcome_message: "æ¬¢è¿è¯­å†…å®¹"
  completion_message: "ç»“æŸè¯­å†…å®¹"
  save_audio: false           # æ˜¯å¦ä¿å­˜éŸ³é¢‘æ–‡ä»¶
  save_transcript: true       # æ˜¯å¦ä¿å­˜è½¬å†™æ–‡æœ¬
```

### ä¼šè¯è®°å½•æ ¼å¼

**JSON æ ¼å¼** (`session.json`)ï¼š
```json
{
  "session_id": "20241118_143052",
  "start_time": "2024-11-18T14:30:52",
  "end_time": "2024-11-18T14:38:15",
  "duration_seconds": 443,
  "total_questions": 8,
  "answers": [
    {
      "question_id": 1,
      "question_text": "è¯·é—®æ‚¨è´µå§“ï¼Ÿ",
      "transcript": "æˆ‘å§“å¼ ",
      "timestamp": "2024-11-18T14:31:05"
    }
  ]
}
```

**æ–‡æœ¬æ ¼å¼** (`summary.txt`)ï¼š
```
============================================================
å®¢æˆ·è®¿è°ˆè®°å½•
ä¼šè¯ID: 20241118_143052
å¼€å§‹æ—¶é—´: 2024-11-18 14:30:52
ç»“æŸæ—¶é—´: 2024-11-18 14:38:15
æ€»æ—¶é•¿: 443 ç§’
============================================================

ã€é—®é¢˜ 1ã€‘
è¯·é—®æ‚¨è´µå§“ï¼Ÿ

ã€å›ç­”ã€‘
æˆ‘å§“å¼ 

------------------------------------------------------------
```

## âš™ï¸ é…ç½®å‚æ•°

### æ¨¡å‹é€‰æ‹©

```python
class ModelType(Enum):
    STEP_AUDIO_2 = "step-audio-2"                    # æ ‡å‡†ç‰ˆï¼ˆæ¨èï¼‰
    STEP_AUDIO_2_MINI = "step-audio-2-mini"          # è½»é‡ç‰ˆ
    STEP_AUDIO_2_THINK = "step-audio-2-think"        # æ€è€ƒç‰ˆ
    STEP_AUDIO_2_MINI_THINK = "step-audio-2-mini-think"
```

### VAD å‚æ•°è°ƒæ•´

```python
client = InterviewClient(
    API_KEY,
    vad_threshold=0.5,              # è¯­éŸ³æ£€æµ‹é˜ˆå€¼ï¼ˆ0.3-0.7ï¼‰
    vad_silence_duration_ms=700     # é™éŸ³æŒç»­æ—¶é•¿ï¼ˆæ¨è600-800ï¼‰
)
```

**å‚æ•°è¯´æ˜ï¼š**
- `vad_threshold`: è¶Šå°è¶Šçµæ•ï¼Œä½†å¯èƒ½è¯¯è§¦å‘
- `vad_silence_duration_ms`: è¶Šé•¿è¶Šç¨³å®šï¼Œä½†å“åº”ä¼šæ…¢ä¸€ç‚¹
- è®¿è°ˆåœºæ™¯å»ºè®®ä½¿ç”¨ 700msï¼Œè®©å®¢æˆ·æœ‰æ€è€ƒæ—¶é—´

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. å®¢æˆ·æ»¡æ„åº¦è°ƒæŸ¥
```yaml
questions:
  - id: 1
    question: "æ‚¨å¯¹äº§å“çš„æ•´ä½“æ»¡æ„åº¦æ˜¯å‡ åˆ†ï¼Ÿ1åˆ°10åˆ†"
    type: "open"
```

### 2. ç”¨æˆ·éœ€æ±‚è°ƒç ”
```yaml
questions:
  - id: 1
    question: "æ‚¨ä¸»è¦ä½¿ç”¨å“ªäº›åŠŸèƒ½ï¼Ÿ"
    type: "open"
  - id: 2
    question: "æ‚¨å¸Œæœ›å¢åŠ ä»€ä¹ˆæ–°åŠŸèƒ½ï¼Ÿ"
    type: "open"
```

### 3. å”®åå›è®¿
```yaml
questions:
  - id: 1
    question: "äº§å“ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜äº†å—ï¼Ÿ"
    type: "yesno"
  - id: 2
    question: "æˆ‘ä»¬çš„æœåŠ¡æ€åº¦å¦‚ä½•ï¼Ÿ"
    type: "open"
```

## ğŸ› ï¸ é«˜çº§åŠŸèƒ½

### è‡ªå®šä¹‰ AI è¡Œä¸º

ä¿®æ”¹ `interview_client.py` ä¸­çš„ `_configure_session` æ–¹æ³•ï¼š

```python
instructions = """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å®¢æˆ·è®¿è°ˆåŠ©æ‰‹ã€‚
1. ç”¨å‹å¥½ã€ä¸“ä¸šçš„è¯­æ°”äº¤æµ
2. é€‚å½“è¿½é—®ç»†èŠ‚
3. å¯¹å®¢æˆ·è¡¨ç¤ºæ„Ÿè°¢
"""
```

### æµ‹è¯•é—®é¢˜ç®¡ç†å™¨

```bash
# å•ç‹¬æµ‹è¯•é—®é¢˜åŠ è½½å’Œè®°å½•åŠŸèƒ½
uv run python question_manager.py
```

### æŸ¥çœ‹è®¿è°ˆè®°å½•

```bash
# æŸ¥çœ‹æ‰€æœ‰ä¼šè¯
ls sessions/

# æŸ¥çœ‹ç‰¹å®šä¼šè¯çš„æ–‡æœ¬æ‘˜è¦
cat sessions/20241118_143052/summary.txt

# æŸ¥çœ‹ JSON è¯¦ç»†è®°å½•
cat sessions/20241118_143052/session.json | python -m json.tool
```

## ğŸ“Š ç¤ºä¾‹é—®é¢˜æ¨¡æ¿

### äº§å“åé¦ˆæ¨¡æ¿
å‚è§ `examples/product_feedback.yaml`

### æœåŠ¡è¯„ä»·æ¨¡æ¿
å‚è§ `examples/service_evaluation.yaml`

### éœ€æ±‚è°ƒç ”æ¨¡æ¿
å‚è§ `examples/requirement_survey.yaml`

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œè¦æ±‚** - éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥
2. **éŸ³é¢‘è®¾å¤‡** - ç¡®ä¿éº¦å…‹é£å’Œæ‰¬å£°å™¨æ­£å¸¸å·¥ä½œ
3. **ç¯å¢ƒå®‰é™** - å»ºè®®åœ¨å®‰é™ç¯å¢ƒä¸‹è¿›è¡Œè®¿è°ˆ
4. **é—®é¢˜æ•°é‡** - å»ºè®®ä¸è¶…è¿‡ 15 ä¸ªé—®é¢˜ï¼ˆçº¦ 10-15 åˆ†é’Ÿï¼‰
5. **å›ç­”è¶…æ—¶** - æ¯ä¸ªé—®é¢˜é»˜è®¤ 2 åˆ†é’Ÿè¶…æ—¶
6. **æå‰ç»“æŸ** - å¯ä»¥ç”¨ `Ctrl+C` æå‰ç»“æŸè®¿è°ˆ

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ API Key
echo $STEPFUN_API_KEY

# æ£€æŸ¥ç½‘ç»œ
ping api.stepfun.com
```

### é—®é¢˜ï¼šéŸ³é¢‘è®¾å¤‡é”™è¯¯
```bash
# æµ‹è¯•éŸ³é¢‘è®¾å¤‡
uv run python -c "import pyaudio; p = pyaudio.PyAudio(); print(p.get_default_input_device_info())"
```

### é—®é¢˜ï¼šé—®é¢˜æ–‡ä»¶åŠ è½½å¤±è´¥
```bash
# éªŒè¯ YAML æ ¼å¼
python -c "import yaml; yaml.safe_load(open('questions.yaml'))"
```

## ğŸ“š æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒç»„ä»¶

1. **QuestionManager** - é—®é¢˜ç®¡ç†
   - åŠ è½½ YAML é…ç½®
   - ç®¡ç†é—®é¢˜é˜Ÿåˆ—
   - è·Ÿè¸ªè¿›åº¦

2. **SessionRecorder** - ä¼šè¯è®°å½•
   - è®°å½•é—®ç­”å¯¹
   - ä¿å­˜ JSON å’Œæ–‡æœ¬æ ¼å¼
   - ç”Ÿæˆæ‘˜è¦

3. **InterviewClient** - è®¿è°ˆå®¢æˆ·ç«¯
   - WebSocket é€šä¿¡
   - éŸ³é¢‘å½•åˆ¶/æ’­æ”¾
   - äº‹ä»¶å¤„ç†

### æ•°æ®æµ

```
é—®é¢˜é…ç½®(YAML) â†’ QuestionManager â†’ InterviewClient
                                        â†“
                              å®æ—¶è¯­éŸ³å¯¹è¯ï¼ˆWebSocketï¼‰
                                        â†“
                              è¯­éŸ³è½¬å†™ â† Whisper
                                        â†“
                              SessionRecorder â†’ ä¿å­˜è®°å½•
```

## ğŸ¤ ä¸ askagent çš„åŒºåˆ«

| ç‰¹æ€§ | askagent | questionAgent |
|------|----------|---------------|
| å¯¹è¯æ¨¡å¼ | è‡ªç”±å¯¹è¯ | ç»“æ„åŒ–æé—® |
| é—®é¢˜ç®¡ç† | æ—  | YAML é…ç½® |
| è®°å½•ä¿å­˜ | æ—  | è‡ªåŠ¨ä¿å­˜ |
| ä½¿ç”¨åœºæ™¯ | æ—¥å¸¸èŠå¤© | å®¢æˆ·è®¿è°ˆ |
| æ‰“æ–­åŠŸèƒ½ | æ”¯æŒ | å—é™ï¼ˆè®¿è°ˆæ¨¡å¼ï¼‰|

## ğŸ“ å‚è€ƒèµ„æ–™

- [askagent é¡¹ç›®](../askagent/README.md)
- [é˜¶è·ƒæ˜Ÿè¾° Realtime API](https://platform.stepfun.com/docs/guide/realtime)
- [YAML æ ¼å¼è¯´æ˜](https://yaml.org/)

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

æœ¬é¡¹ç›®åŸºäº [askagent](../askagent/) å®æ—¶è¯­éŸ³å¯¹è¯åŠ©æ‰‹å¼€å‘ã€‚

---

**å¿«é€Ÿå¼€å§‹**: `uv run python interview_client.py`

